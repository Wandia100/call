;/*FB_PKG_DELIM*/

__d("usePrefetchRouteDefinition",["PolarisMonitorErrors","react","useCometRouterDispatcher"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useEffect;function a(a){var b=c("useCometRouterDispatcher")();h(function(){try{b==null?void 0:b.prefetchRouteDefinition(a)}catch(a){d("PolarisMonitorErrors").logError(a)}},[a,b])}g["default"]=a}),98);
__d("PolarisCreateLocationRoot.entrypoint",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(a){return{queries:{}}},root:c("JSResourceForInteraction")("PolarisCreateLocationRoot.react").__setRef("PolarisCreateLocationRoot.entrypoint")};g["default"]=a}),98);
__d("PolarisCreateStyleRoot.entrypoint",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(a){return{queries:{}}},root:c("JSResourceForInteraction")("PolarisCreateStyleRoot.react").__setRef("PolarisCreateStyleRoot.entrypoint")};g["default"]=a}),98);
__d("PolarisCreateTagRoot.entrypoint",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(a){return{queries:{}}},root:c("JSResourceForInteraction")("PolarisCreateTagRoot.react").__setRef("PolarisCreateTagRoot.entrypoint")};g["default"]=a}),98);
__d("PolarisDataDownloadRequestRoot.entrypoint",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(a){return{queries:{}}},root:c("JSResourceForInteraction")("PolarisDataDownloadRequestRoot.react").__setRef("PolarisDataDownloadRequestRoot.entrypoint")};g["default"]=a}),98);
__d("PolarisStoryCreationStrings",["fbt"],(function(a,b,c,d,e,f,g,h){"use strict";a=h._("Discard Photo?");b=h._("If you go back now, you will lose your photo");c=h._("Discard Video?");d=h._("If you go back now, you will lose your video");e=h._("Discard");f=h._("Keep");var i=h._("Keep"),j=h._("Rotate your device to add to your story."),k=h._("Rotate your device to continue editing your story."),l=h._("Tap for more"),m=h._("Can't load stickers"),n=h._("Check your internet connection and try again."),o=h._("RETRY"),p=h._("Add to your story"),q=h._("Your photo was added."),r=h._("Your video was added."),s=h._("Upload failed."),t=h._("Your photo was added."),u=h._("Upload failed."),v=h._("Your Story");h=h._("Send to");g.EXIT_STORY_CREATION_CONFIRM_TITLE=a;g.EXIT_STORY_CREATION_CONFIRM_TEXT=b;g.EXIT_STORY_VIDEO_CREATION_CONFIRM_TITLE=c;g.EXIT_STORY_VIDEO_CREATION_CONFIRM_TEXT=d;g.EXIT_STORY_CREATION_DISCARD_TEXT=e;g.EXIT_STORY_CREATION_KEEP_TEXT=f;g.EXIT_STORY_CREATION_KEEP_MEDIA_TEXT=i;g.STORY_LANDSCAPE_WARNING_TEXT=j;g.STORY_LANDSCAPE_WARNING_TEXT_EDITING=k;g.TAP_FOR_MORE=l;g.CANNOT_LOAD_STICKERS=m;g.CHECK_CONNECTION=n;g.RETRY=o;g.ADD_TO_STORY_TEXT=p;g.PHOTO_ADDED_TEXT=q;g.VIDEO_ADDED_TEXT=r;g.UPLOAD_FAILED_TEXT=s;g.PHOTO_ADDED_TEXT_NEW=t;g.UPLOAD_FAILED_TEXT_NEW=u;g.YOUR_STORY_TEXT=v;g.SEND_TO_TEXT=h}),98);
__d("PolarisBirthdayStrings",["fbt","PolarisDateHelpers","PolarisDateStrings"],(function(a,b,c,d,e,f,g,h){"use strict";c=h._("Confirm Your Birthday");function a(a){a=d("PolarisDateStrings").getReadableDateString(a);return h._("Is {birthday} your birthday?",[h._param("birthday",a)])}function b(a){a=d("PolarisDateStrings").getAgeText(d("PolarisDateHelpers").getAge(a));return h._("Are you {age}?",[h._param("age",a)])}g.CONFIRM_YOUR_BIRTHDAY=c;g.getBirthdayConfirmationText=a;g.getBirthdayConfirmationAgeText=b}),98);
__d("PolarisManageApplicationsPageContainer.react",["PolarisManageApplicationsPage.react","PolarisManageApplicationsPageStrings","PolarisSettingsActions","PolarissettingsReducer","react","react-redux-wwwig"],(function(a,b,c,d,e,f,g){"use strict";d("react");function a(a,b){return{authorizations:d("PolarissettingsReducer").getAppAuthorizations(a),pendingInvites:d("PolarissettingsReducer").getPendingInvites(a),acceptedInvites:d("PolarissettingsReducer").getAcceptedInvites(a),revokingAccessForAppTokens:d("PolarissettingsReducer").revokingAccessForAppTokens(a),revokingPermissionRequests:d("PolarissettingsReducer").getRevokingPermissionRequests(a)}}function b(a){return{onRevokeAccess:function(b){a(d("PolarisSettingsActions").revokeAccess(b))},onDeclineInvite:function(b){a(d("PolarisSettingsActions").declineInvite(b))},onAcceptInvite:function(b){a(d("PolarisSettingsActions").acceptInvite(b))},onBatchRevokePermissions:function(){a(d("PolarisSettingsActions").batchRevokePermissions())},onAddRevokingPermission:function(b){a(d("PolarisSettingsActions").addRevokingPermission(b))},onRemoveRevokingPermission:function(b){a(d("PolarisSettingsActions").removeRevokingPermission(b))},onClearRevokingPermission:function(){a(d("PolarisSettingsActions").clearRevokingPermissions())}}}c=d("react-redux-wwwig").connect(a,b)(d("PolarisManageApplicationsPage.react").ManageApplicationsPage);g.PAGE_ID=d("PolarisManageApplicationsPageStrings").PAGE_ID;g.ManageApplicationsPageContainer=c}),98);
__d("PolarisUploadProgressActions",["react"],(function(a,b,c,d,e,f,g){"use strict";d("react");function a(){return{type:"DISMISS_AND_RESET_UPLOAD"}}function b(a){return{type:"UPDATE_UPLOAD_PROGRESS",progress:a}}function c(a){return{type:"UPDATE_UPLOAD_STATUS",status:a}}function e(a){var b=a.actionNode;a=a.text;return{type:"UPDATE_UPLOAD_TEXT",actionNode:b,text:a}}function f(a){return{type:"UPDATE_UPLOAD_THUMBNAIL_URL",thumbnailURL:a}}g.dismissAndResetUploadProgress=a;g.updateUploadProgress=b;g.updateUploadProgressStatus=c;g.updateUploadProgressText=e;g.updateUploadProgressThumbnail=f}),98);
__d("PolarisgetVideoCoverPhoto",["PolarisMediaConstants","PolarisgetBlobFromCanvas","Promise","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c=b;b=a/b;b<d("PolarisMediaConstants").VIDEO_ASPECT_RATIO_MIN&&(c=a/d("PolarisMediaConstants").VIDEO_ASPECT_RATIO_MIN);return{canvasWidth:a,canvasHeight:c}}function i(a,b){var c=null,e=0;a-b!==0&&(e=(a-b)/2,c=d("PolarisMediaConstants").VIDEOTRANSFORM.center_crop);return{videoTransform:c,yOffset:e}}function j(a,b){a=h(a,b);var c=a.canvasWidth;a=a.canvasHeight;b=i(b,a);var d=b.yOffset;b=b.videoTransform;return{canvasWidth:c,canvasHeight:a,yOffset:d,videoTransform:b}}function a(a,d){d===void 0&&(d=!1);return new(b("Promise"))(function(b,e){e=a.videoWidth;var f=a.videoHeight,g=document.createElement("canvas"),h=e,i=f,k=null,l=0;if(d){e=j(e,f);h=e.canvasWidth;i=e.canvasHeight;k=e.videoTransform;l=e.yOffset}g.setAttribute("width",h+"px");g.setAttribute("height",i+"px");var m=c("nullthrows")(g.getContext("2d"));a.autoplay=!0;a.muted=!0;a.currentTime=1;a.oncanplay=function(){a.play().then(function(){window.setTimeout(function(){m.drawImage(a,0,l,h,i,0,0,h,i);return c("PolarisgetBlobFromCanvas")(g).then(function(a){return b({file:a,dataURL:window.URL.createObjectURL(a),uploadMediaWidth:h,uploadMediaHeight:i,videoTransform:k})})},1e3)})}})}g.getCroppedCanvasDimensions=h;g.getVideoTransformMetaData=i;g.getCroppedCanvasMetaData=j;g.getVideoCoverPhoto=a}),98);
__d("PolarisrenderCroppedImage",["nullthrows","warning"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.sourceImg,d=a.offsetLeft,e=a.offsetTop,f=a.imageWidth,g=a.imageHeight,h=a.scaleFactor,i=a.rotationAngle;a=a.resolution;a=a===void 0?1080:a;c("warning")(i%90===0,"Rotation angle should be multiple of 90 degrees");var j=h*g/f;h=Math.min(f/h,f-d);f=Math.min(g/j,g-e);h>=f?(j=a,g=a*f/h):(g=a,j=a*h/f);a=i%180===90;var k=a?j:g;a=a?g:j;var l=document.createElement("canvas");l.width=a;l.height=k;var m=c("nullthrows")(l.getContext("2d"));m.translate(a/2,k/2);m.rotate(i*Math.PI/180);m.drawImage(b,d,e,h,f,-j/2,-g/2,j,g);return l}g["default"]=a}),98);
__d("PolarisCreationActions",["fbt","invariant","PolarisAPI","PolarisAssetManagerGlyphMapping","PolarisConsumerDataCache","PolarisCreationAPI","PolarisCreationCameraLogger","PolarisCreationLogger","PolarisCreationMode","PolarisCreationStrings","PolarisCreationUtils","PolarisFeedActionConstants","PolarisFeedActions","PolarisGenericStrings","PolarisIGCoreIcon","PolarisImageFactory","PolarisLinkBuilder","PolarisMediaConstants","PolarisMonitorErrors","PolarisNavigationActions","PolarisNavigationUtils","PolarisToastActions","PolarisUploadProgressActions","PolarisgetBlobFromCanvas","PolarisgetVideoCoverPhoto","PolarisisWebGLSupported","PolarisreadImageFile","PolarisreadVideoFile","PolarisrenderCroppedImage","PolarisuserSelectors","Promise","browserHistory","gkx","nullthrows","react","regeneratorRuntime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=d("react"),k=5,l=12;function m(a){a=d("PolarisCreationStrings").POST_FAILED_TEXT;return a}function n(a,b){return!a?null:{actionHandler:a,actionText:d("PolarisGenericStrings").RETRY_TEXT,text:m(b)}}function o(a,b){return function(c,e){var f=e();f=f.creation;var g=f.sessionId||"",j=f.finalizedMedia,k=j.caption,l=j.customAccessibilityCaption,m=j.geoTag;j=j.usertags;var o=f.filter.filterName,q=f.creationMode;f=j?Array.from(j.values()):[];j=d("PolarisCreationAPI").configure({uploadId:a,caption:k,geoTag:m,usertags:f,customAccessibilityCaption:l});return j.then(function(a){var b;if(((b=a.media)==null?void 0:b.pk)!=null&&((b=a.media)==null?void 0:b.id)!=null){c({type:"CREATION_FINALIZE_PHOTO_SUCCESS",mediaKey:String(a.media.pk)});a.media!=null&&a.media.id!=null||i(0,50426);b=String(a.media.id).split("_")[0];d("PolarisCreationLogger").logFilterUsed(g,"has_used_filter","share_page",d("PolarisisWebGLSupported").isWebGLSupported()?o:null);m&&d("PolarisCreationLogger").logCreationEvent(g,"has_added_location","share_page",d("PolarisMediaConstants").MediaTypes.IMAGE);d("PolarisCreationLogger").logPostSucceeded(g,b,d("PolarisMediaConstants").MediaTypes.IMAGE);c(d("PolarisFeedActions").refreshFeedData(d("PolarisFeedActionConstants").PAGE_SIZE,!0)).then(function(){var a=d("PolarisuserSelectors").getViewer(e());a&&a.username!=null&&a.username!==""&&d("PolarisConsumerDataCache").invalidatePath(d("PolarisLinkBuilder").buildUserLink(a.username));d("browserHistory").browserHistory.push("/");c(d("PolarisNavigationActions").setNavSelection("NAVIGATION_SECTION_HOME"));c(d("PolarisToastActions").showToast({text:h._("Your photo was posted."),persistOnNavigate:!0}));q===d("PolarisCreationMode").CreationMode.PROFILE_PIC_POST_UPSELL&&c(p())},function(){d("PolarisNavigationUtils").openURLWithFullPageReload("/")})}else throw new Error(a.error_title)})["catch"](function(a){c({type:"CREATION_FINALIZE_PHOTO_FAILED",error:a,toast:n(b,a)}),d("PolarisCreationLogger").logPostFailed(g,a,"finalize",d("PolarisMediaConstants").MediaTypes.IMAGE)})}}function a(a){return{type:"CREATION_PHOTO_CROP_CHANGED",croppedImage:a}}function p(){return{type:"CREATION_RELEASED"}}function e(a){return{type:"CREATION_CAPTION_CHANGED",caption:a}}function q(a){return{type:"CREATION_GEO_TAG_ADDED",geoTag:a}}function r(a){return{type:"CREATION_CURRENT_LOCATION_RECEIVED",currentLocation:a}}function s(){return{type:"CREATION_GEO_TAG_REMOVED"}}var t;function u(){return function(a,d){d=d().creation;var e=d.croppedImage,f=d.sourceImage,g=c("PolarisImageFactory").createImage();f!=null||i(0,50427);e!=null||i(0,50428);return new(b("Promise"))(function(b){g.onload=function(){var d=c("PolarisrenderCroppedImage")({sourceImg:g,offsetLeft:e.offsetLeft,offsetTop:e.offsetTop,imageWidth:f.width,imageHeight:f.height,scaleFactor:e.scaleFactor,rotationAngle:e.rotationAngle});b(a({type:"CREATION_CROP_RENDERED",canvas:d}))},g.src=f.dataURL})}}function v(a,b,c){return function(e,f){e({type:"CREATION_STAGE_PHOTO_REQUESTED",imageURL:b,blob:a});t!=null&&(t.abort(),t=null);var g,h=f().creation.sessionId||"";return d("PolarisAPI").fbUploaderPhoto(a,function(a){return t=g=a}).then(function(a){if(g&&g!==t)return;t=null;a=a.upload_id;e({type:"CREATION_STAGE_PHOTO_SUCCEEDED",uploadId:a});var b=f().creation.finalizedMedia;b.isFinalizing===!0&&e(o(a))})["catch"](function(a){var b=f().creation.finalizedMedia;e({type:"CREATION_STAGE_PHOTO_FAILED",error:a,toast:n(c,a)});b.isFinalizing===!0&&d("PolarisCreationLogger").logPostFailed(h,a,"stage",d("PolarisMediaConstants").MediaTypes.IMAGE)})}}function w(a){return function(c,d){d=d().creation;var e=d.finalizedMedia;d=d.stagedImage;e.isFinalizing!==!0||i(0,50429);c({type:"CREATION_FINALIZE_PHOTO_ATTEMPTED"});if(d.error){d.blob&&d.dataURL!=null&&d.dataURL!==""||i(0,50430);return c(v(d.blob,d.dataURL,a))}else if(d.uploadId!=null&&d.uploadId!=="")return c(o(d.uploadId,a));d.isStaging===!0||i(0,50431);return b("Promise").resolve()}}function x(a,b){return d("PolarisAPI").ruploadVideo(a,b)}function y(a){return d("PolarisAPI").ruploadPhoto(a)}function z(a,c,e,f,g,h,j){j===void 0&&(j=0);return function(n,o){return b("regeneratorRuntime").async(function(b){while(1)switch(b.prev=b.next){case 0:return b.abrupt("return",d("PolarisAPI").creationFinalizeMedia(a,c,e,g,f,d("PolarisMediaConstants").MediaTypes.VIDEO,h).then(function(a){if(a.media&&a.media.pk&&a.media.id){a.media!=null&&a.media.id!=null||i(0,50426);var b=String(a.media.id).split("_")[0],c=o().creation.sessionId||"",e=function(){n(d("PolarisFeedActions").refreshFeedData(d("PolarisFeedActionConstants").PAGE_SIZE,!0)),n(d("PolarisUploadProgressActions").dismissAndResetUploadProgress())};d("PolarisCreationLogger").logPostSucceeded(c,b,d("PolarisMediaConstants").MediaTypes.VIDEO);n(p());n(d("PolarisUploadProgressActions").updateUploadProgressStatus("done"));n(d("PolarisUploadProgressActions").updateUploadProgressText({text:d("PolarisCreationStrings").POST_DONE_TEXT,actionNode:P(e)}))}else throw a})["catch"](function(b){var h=j+1;if(b.statusCode===0&&h<=k)n(z(a,c,e,f,g,l,h));else{d("PolarisMonitorErrors").logError(b);h=function(){n(d("PolarisUploadProgressActions").dismissAndResetUploadProgress()),n(p())};n(d("PolarisUploadProgressActions").updateUploadProgressStatus("failed"));n(d("PolarisUploadProgressActions").updateUploadProgressText({text:m(b),actionNode:P(h)}))}}));case 1:case"end":return b.stop()}},null,this)}}function A(a,e){return function(e,f){var g,h,i,j,k,n,o,q,r,s,t;return b("regeneratorRuntime").async(function(b){while(1)switch(b.prev=b.next){case 0:g=f().creation.sessionId||"";h=f().creation,i=h.coverPhoto,j=h.finalizedMedia,k=h.sourceVideo;n=j.caption,o=j.customAccessibilityCaption,q=j.geoTag,r=j.usertags;s=r?Array.from(r.values()):[];e(d("PolarisUploadProgressActions").updateUploadProgressThumbnail(c("nullthrows")(i.dataURL)));d("browserHistory").browserHistory.push("/");e(d("PolarisNavigationActions").setNavSelection("NAVIGATION_SECTION_HOME"));t=function(a){e(d("PolarisUploadProgressActions").updateUploadProgress(d("PolarisAPI").transferProgressObjectToOptimisticPercent(a)))};e(d("PolarisUploadProgressActions").updateUploadProgressStatus("uploading"));return b.abrupt("return",x(k,t).then(function(){return y(i)}).then(function(){e(d("PolarisUploadProgressActions").updateUploadProgressStatus("finishing")),e(d("PolarisUploadProgressActions").updateUploadProgressText({text:d("PolarisCreationStrings").POST_FINISHING_TEXT,actionNode:null})),e(z(a,n,q,o,s,l))})["catch"](function(a){d("PolarisMonitorErrors").logError(a);var b=function(){e(d("PolarisUploadProgressActions").dismissAndResetUploadProgress()),e(p())};e(d("PolarisUploadProgressActions").updateUploadProgressStatus("failed"));d("PolarisCreationLogger").logPostFailed(g,a,"finalize",d("PolarisMediaConstants").MediaTypes.VIDEO);e(d("PolarisUploadProgressActions").updateUploadProgressText({text:m(a),actionNode:P(b)}))}));case 10:case"end":return b.stop()}},null,this)}}function B(a,b,e){return function(f){var g=Math.random().toString(36).slice(2);f({type:"CREATION_SESSION_STARTED",sessionId:g,creationMode:b,showChangeProfilePicConfirmDialog:e});c("gkx")("4779")||d("PolarisCreationLogger").logEnterFlow(g,a);d("PolarisCreationCameraLogger").logFeedCreationStartCameraSession({sessionId:g});d("PolarisCreationCameraLogger").logFeedCreationCameraStartGallerySession({sessionId:g})}}function C(a){return function(b,e){var f=a.type;if(d("PolarisreadImageFile").isImage(f)){f=e().creation.sessionId;d("PolarisCreationCameraLogger").logFeedCreationFeedGallerySelectMedia({mediaType:d("PolarisCreationCameraLogger").InstagramCameraMediaTypes.PHOTO,sessionId:c("nullthrows")(f)});b(H(a))}else b(O(new Error(d("PolarisCreationStrings").NOT_SUPPORTED_MEDIA_TEXT))),b(N("error"))}}function D(a){var b=a.videoHeight,c=a.videoWidth;a=Math.floor(a.duration*1e3);var e=c/b,f=[];a===0&&c===0&&b===0?f.push(d("PolarisCreationStrings").NOT_SUPPORTED_VIDEO_TEXT):(a<d("PolarisMediaConstants").FEED_MINIMUM_VIDEO_DURATION*1e3?f.push(d("PolarisCreationStrings").MIN_DURATION_VIDEO_TEXT):a>d("PolarisMediaConstants").FEED_MAXIMUM_VIDEO_DURATION*1e3&&f.push(d("PolarisCreationStrings").MAX_DURATION_VIDEO_TEXT),e>d("PolarisMediaConstants").IMAGE_ASPECT_RATIO_MAX&&f.push(d("PolarisCreationStrings").INVALID_ASPECT_RATIO_VIDEO_TEXT));return{aspectRatio:e,uploadMediaDurationMs:a,uploadMediaWidth:c,uploadMediaHeight:b,invalidMediaError:f}}function E(a){return d("PolarisreadVideoFile").readVideoFile(a)}function F(a){return d("PolarisgetVideoCoverPhoto").getVideoCoverPhoto(a,!0)}function G(a){return function(c,e){var f=e().creation.sessionId||"",g=e().users,h=String(+g.viewerId+ +Date.now()),i="feed_"+h;g=e().uploadProgress.progress;g!==0&&c(d("PolarisUploadProgressActions").dismissAndResetUploadProgress());if(!d("PolarisreadVideoFile").isMP4Video(a.type)){c(O(new Error(d("PolarisCreationStrings").NOT_SUPPORTED_VIDEO_FORMAT_TEXT)));c(N("error"));return null}var j,k;return E(a).then(function(a){d("PolarisCreationLogger").logCreationEvent(f,"video_processed","crop_page",d("PolarisMediaConstants").MediaTypes.VIDEO);k=D(a);var e=k;e=e.invalidMediaError;if(e.length>0){c(O(new Error(e[0])));c(N("error"));return b("Promise").reject(new Error("invalid video media"))}j=a.src;return F(a)}).then(function(b){c({type:"CREATION_VIDEO_PROCESSED",dataURL:j,entityName:i,file:a,uploadId:h,uploadMediaHeight:k.uploadMediaHeight,uploadMediaWidth:k.uploadMediaWidth,uploadMediaDurationMs:k.uploadMediaDurationMs,videoTransform:b.videoTransform,mediaPublishMode:d("PolarisMediaConstants").MediaPublishMode.FEED}),c({type:"CREATION_VIDEO_COVER_PHOTO_UPDATED",dataURL:b.dataURL,entityName:i,file:b.file,uploadId:h,uploadMediaHeight:b.uploadMediaHeight,uploadMediaWidth:b.uploadMediaWidth}),d("browserHistory").browserHistory.push("/create/style/")})["catch"](function(a){a instanceof Error&&(d("PolarisMonitorErrors").logError(a),c(O(a)),c(N("error")))})}}function H(a){return function(b,e){var f=e().creation.sessionId||"";return d("PolarisreadImageFile").readImageFile(a).then(function(e){c("gkx")("4779")||d("PolarisCreationLogger").logCreationEvent(f,"image_processed","crop_page",d("PolarisMediaConstants").MediaTypes.IMAGE),d("PolarisCreationCameraLogger").logFeedCreationCameraEndGallerySession({sessionId:f}),b({type:"CREATION_IMAGE_PROCESSED",height:e.height,location:e.location,mirrored:e.mirrored,orientation:e.orientation,rotationAngle:e.rotationAngle,sourceDataURL:e.dataURL,sourceImage:a,width:e.width}),d("browserHistory").browserHistory.push("/create/style/")},function(a){b(d("PolarisToastActions").showToast({text:h._("Upload failed. Only images can be posted."),persistOnNavigate:!0}))})}}function I(a){return function(b){b(B("profile_pic_upsell",d("PolarisCreationMode").CreationMode.PROFILE_PIC_POST_UPSELL));return d("PolarisreadImageFile").readImageFile(a).then(function(a){var e=babelHelpers["extends"]({},d("PolarisCreationUtils").getDefaultCrop(a.width,a.width),{mirrored:a.mirrored,rotationAngle:a.rotationAngle}),f=c("PolarisImageFactory").createImage();f.onload=function(){var g=c("PolarisrenderCroppedImage")({sourceImg:f,offsetLeft:e.offsetLeft,offsetTop:e.offsetTop,scaleFactor:e.scaleFactor,rotationAngle:e.rotationAngle,imageWidth:a.width,imageHeight:a.height});return c("PolarisgetBlobFromCanvas")(g).then(function(a){return d("PolarisAPI").fbUploaderPhoto(a)}).then(function(a){return b(o(a.upload_id))})};f.src=a.dataURL})["catch"](function(a){b(d("PolarisToastActions").showToast({text:h._("Upload failed."),persistOnNavigate:!0}))})}}function J(a){return function(b,c){return d("PolarisAPI").creationLoadSuggestedGeoTags(a).then(function(a){b({type:"CREATION_SUGGESTED_GEO_TAGS_LOADED",suggestedGeoTags:a.venues})})}}function K(a){return{type:"CREATION_SET_FILTER_NAME",filterName:a}}function L(a){return{type:"CREATION_USERTAGS_UPDATED",usertags:a}}function M(a){return{type:"CREATION_CUSTOM_ACCESSIBILITY_CAPTION_UPDATED",customAccessibilityCaption:a}}function N(a){return{type:"CREATION_DIALOG_STATUS",creationDialogStatus:a}}function O(a){return{type:"CREATION_ERROR",error:a}}function P(a){return j.jsx("span",{onClick:a,role:"button",tabIndex:0,children:j.jsx(c("PolarisIGCoreIcon"),{alt:"Close",icon:d("PolarisAssetManagerGlyphMapping").ICONS.X_OUTLINE_24_GREY9})})}P.displayName=P.name+" [from "+f.id+"]";g.changeCrop=a;g.resetState=p;g.changeCaption=e;g.addGeoTag=q;g.setCurrentLocation=r;g.removeGeoTag=s;g.renderCroppedPhoto=u;g.stagePhoto=v;g.finalizePhoto=w;g.creationFinalizeVideo=z;g.finalizeVideo=A;g.startCreationSession=B;g.creationSelectMedia=C;g.creationSelectVideo=G;g.creationSelectImage=H;g.startCreationSesssionFromProfilePic=I;g.loadSuggestedGeoTags=J;g.setFilterName=K;g.updateUsertags=L;g.saveAltText=M;g.updateCreationDialogStatus=N;g.updateCreationError=O}),98);
__d("PolarisGenderActions",["fbt","PolarisAPI","PolarisGenericStrings"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a,b){return function(c){c({type:"GENDER_INFO_LOADED",customGender:b,gender:a})}}function i(a,b){return function(c){c({type:"GENDER_INFO_UPDATE_REQUESTED"});return d("PolarisAPI").setGender(a,b).then(function(d){c({type:"GENDER_INFO_UPDATE_SUCCEEDED",customGender:b,gender:a})},function(e){c({type:"GENDER_INFO_UPDATE_FAILED",toast:{text:e.message||h._("An error occurred. Please try again."),actionText:d("PolarisGenericStrings").RETRY_TEXT,actionHandler:function(){return c(i(a,b))}}})})}}g.loadGenderInfo=a;g.updateGenderInfo=i}),98);
__d("PolarisStoryCreationLogger",["PolarisLogger","PolarisPigeonLogger"],(function(a,b,c,d,e,f,g){"use strict";b={POST:1,EXIT:2,UNKNOWN:-1};var h={event_name:"reel_creation_waterfall",library_upload_count:1,library_media_available:1,media_type:"1",source:"library",has_flash:!1,camera_position:null,capture_type:"normal",text_edit_count:0,text_edit_duration:0,tool_toggle_count:0,duration:0,color_toggle_count:0,save_media_count:0,has_text:!1,has_brush:!1,sticker_ids:[],sticker_toggle_count:0,has_sticker:!1};function a(a){switch(a.step){case"enter":case"image_process_attempt":case"image_process_success":case"image_process_failure":d("PolarisLogger").logPigeonEvent(d("PolarisPigeonLogger").createEvent("instagram_web_story_creation",d("PolarisLogger").getExtra(babelHelpers["extends"]({},a,{event_name:"reel_creation_waterfall"}))));return;case"compose_stage_attempt":case"compose_finalize_attempt":case"compose_failure":case"compose":case"exit_attempt":case"exit_cancel":case"exit":d("PolarisLogger").logPigeonEvent(d("PolarisPigeonLogger").createEvent("instagram_web_story_creation",d("PolarisLogger").getExtra(babelHelpers["extends"]({},h,a))));return}}g.STORY_CREATION_EXIT_POINT=b;g.logStoryCreationEvent=a}),98);
__d("PolarisStoryCreationActions",["fbt","PolarisAPI","PolarisCreationActions","PolarisCreationCameraLogger","PolarisCreationStrings","PolarisGenericStrings","PolarisMediaConstants","PolarisMonitorErrors","PolarisNavigationActions","PolarisQEHelper","PolarisStoryActions","PolarisStoryCreationLogger","PolarisStoryCreationStrings","PolarisStoryCreationUtils","PolarisToastActions","PolarisgetVideoCoverPhoto","PolarisreadImageFile","PolarisreadVideoFile","Polarisunexpected","PolarisuserSelectors","Promise","browserHistory","nullthrows","uuid"],(function(a,b,c,d,e,f,g,h){"use strict";var i="error";function j(a){for(var b=0;b<a.length;b++)if(typeof a[b].id==="number")return b;return-1}function a(a,b){return{type:"STORY_CREATION_SET_CANVAS_DIMENSIONS",canvasWidth:a,canvasHeight:b}}function e(a){return function(e,f){return new(b("Promise"))(function(b,g){var h=f().displayProperties,i=h.viewportHeight;h=h.viewportWidth;if(i<h){e(d("PolarisToastActions").showToast({text:d("PolarisStoryCreationStrings").STORY_LANDSCAPE_WARNING_TEXT}));return g({})}i=c("uuid")();e({type:"STORY_CREATION_SESSION_STARTED",sessionId:i,entryPoint:a,startTime:Date.now()});d("PolarisStoryCreationLogger").logStoryCreationEvent({step:"enter",waterfall_id:i,entry_point:a});d("PolarisCreationCameraLogger").logStoryCreationStartCameraSession({sessionId:i});return b({})})}}function k(a,b){b=b.storyCreation;var e=b.logData,f=e.start_time;e=babelHelpers.objectWithoutPropertiesLoose(e,["start_time"]);f=(Date.now()-f)/1e3;var g=b.canvasStickers,h=!1,i=[];for(var g=g,j=Array.isArray(g),k=0,g=j?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var l;if(j){if(k>=g.length)break;l=g[k++]}else{k=g.next();if(k.done)break;l=k.value}l=l;l.type===d("PolarisStoryCreationUtils").TEXT_TYPE?h=!0:i.push(l.variants[0].id)}return babelHelpers["extends"]({},e,{exit_point:d("PolarisStoryCreationLogger").STORY_CREATION_EXIT_POINT.POST,has_brush:b.activeDrawing.linesArray.length>0,has_sticker:i.length>0,has_text:h,step:a,sticker_ids:i,waterfall_duration:f,waterfall_id:c("nullthrows")(b.sessionId)})}function f(a){return function(b){var c=a.type;d("PolarisreadImageFile").isImage(c)?b(l(a)):d("PolarisreadVideoFile").isVideo(c)&&d("PolarisQEHelper").getIgLiteStoryVideoUploadQE()?b(m(a)):(b(d("PolarisCreationActions").updateCreationError(new Error(d("PolarisCreationStrings").NOT_SUPPORTED_MEDIA_TEXT))),b(d("PolarisCreationActions").updateCreationDialogStatus("error")))}}function l(a){return function(b,e){var f=e(),g=f.storyCreation.sessionId;d("PolarisStoryCreationLogger").logStoryCreationEvent(k("image_process_attempt",f));g!=null&&d("PolarisCreationCameraLogger").logStoryCreationFeedGallerySelectMedia({mediaType:d("PolarisCreationCameraLogger").InstagramCameraMediaTypes.PHOTO,sessionId:g});return d("PolarisreadImageFile").readImageFile(a).then(function(c){b({type:"STORY_CREATION_IMAGE_PROCESSED",height:c.height,location:c.location,orientation:c.orientation,sourceDataURL:c.dataURL,sourceImage:a,width:c.width,flash:c.flash}),d("PolarisStoryCreationLogger").logStoryCreationEvent(k("image_process_success",e())),d("browserHistory").browserHistory.push("/create/story/"),g!=null&&d("PolarisCreationCameraLogger").logStoryCreationCameraEndGallerySession({sessionId:g})},function(a){d("PolarisStoryCreationLogger").logStoryCreationEvent(k("image_process_failure",f)),b(d("PolarisToastActions").showToast({text:h._("Upload failed. Only images can be posted."),persistOnNavigate:!0})),a instanceof Error?(a.name="[StoryCreation] "+a.name,d("PolarisMonitorErrors").logError(a)):c("Polarisunexpected")("[StoryCreation] error in processing image")})}}function m(a){return function(b,e){var f=Date.now().toString(),g="story_"+f,h=e().storyCreation.sessionId;h!=null&&d("PolarisCreationCameraLogger").logStoryCreationFeedGallerySelectMedia({mediaType:d("PolarisCreationCameraLogger").InstagramCameraMediaTypes.VIDEO,sessionId:h});return d("PolarisreadVideoFile").readVideoFile(a).then(function(c){b({type:"STORY_CREATION_VIDEO_PROCESSED",dataURL:c.src,entityName:g,file:a,uploadId:f,uploadMediaHeight:c.videoHeight,uploadMediaWidth:c.videoWidth,uploadMediaDurationMs:Math.floor(c.duration*1e3),videoTransform:null,mediaPublishMode:d("PolarisMediaConstants").MediaPublishMode.REEL});return d("PolarisgetVideoCoverPhoto").getVideoCoverPhoto(c)}).then(function(a){b({type:"STORY_CREATION_VIDEO_COVER_PHOTO_UPDATED",dataURL:a.dataURL,entityName:g,file:a.file,uploadId:f,uploadMediaHeight:a.uploadMediaHeight,uploadMediaWidth:a.uploadMediaWidth}),d("browserHistory").browserHistory.push("/create/story/"),h!=null&&d("PolarisCreationCameraLogger").logStoryCreationCameraEndGallerySession({sessionId:h})})["catch"](function(a){a instanceof Error?(a.name="[StoryCreation] "+a.name,d("PolarisMonitorErrors").logError(a)):c("Polarisunexpected")("[StoryCreation] error in processing video")})}}function n(a,b){return function(e,f){e({type:"STORY_CREATION_UPLOAD_REQUESTED",uploadedBlob:a});var g=f(),h=g.storyCreation.activeText.renderText.join("\n");d("PolarisStoryCreationLogger").logStoryCreationEvent(k("compose_stage_attempt",g));return d("PolarisAPI").fbUploaderPhoto(a).then(function(a){var b=a.upload_id;e({type:"STORY_CREATION_UPLOAD_STAGED",uploadId:b});g=f();a=g.storyCreation;var c=a.mediaType,i=a.sessionId;d("PolarisStoryCreationLogger").logStoryCreationEvent(k("compose_finalize_attempt",g));return d("PolarisAPI").creationFinalizeStory(b,h).then(function(a){d("PolarisStoryCreationLogger").logStoryCreationEvent(k("compose",g)),c!=null&&i!=null&&d("PolarisCreationCameraLogger").logStoryCreationShareMedia({mediaType:c,sessionId:i}),e({type:"STORY_CREATION_UPLOAD_SUCCEEDED",toast:{text:d("PolarisStoryCreationStrings").PHOTO_ADDED_TEXT,persistOnNavigate:!0},uploadId:b}),e(q())})["catch"](function(a){throw a})})["catch"](function(a){d("PolarisStoryCreationLogger").logStoryCreationEvent(k("compose_failure",g)),e({type:"STORY_CREATION_UPLOAD_FAILED",toast:{text:d("PolarisStoryCreationStrings").UPLOAD_FAILED_TEXT,persistOnNavigate:!0,actionText:b&&d("PolarisGenericStrings").RETRY_TEXT,actionHandler:b}}),a instanceof Error?(a.name="[StoryCreation] "+a.name,d("PolarisMonitorErrors").logError(a)):c("Polarisunexpected")("[StoryCreation] error in uploading story")})}}function o(a){return function(b){return d("PolarisAPI").creationFinalizeStory(a).then(function(c){if(c.media&&c.media.pk)b({type:"STORY_CREATION_UPLOAD_SUCCEEDED",toast:{text:d("PolarisStoryCreationStrings").VIDEO_ADDED_TEXT,persistOnNavigate:!0},uploadId:a}),b(q());else throw c})}}function p(){return function(a,b){b=b().storyCreation;var e=b.coverPhoto;b=b.sourceVideo;var f=c("nullthrows")(b).uploadId;a({type:"STORY_CREATION_VIDEO_UPLOAD_REQUESTED"});return d("PolarisAPI").ruploadVideo(b).then(function(){return d("PolarisAPI").ruploadPhoto(e)}).then(function(){return a(o(f))})["catch"](function(b){d("browserHistory").browserHistory.push("/"),a(d("PolarisNavigationActions").setNavSelection("NAVIGATION_SECTION_HOME")),a({type:"STORY_CREATION_UPLOAD_FAILED",toast:{text:d("PolarisStoryCreationStrings").UPLOAD_FAILED_TEXT,persistOnNavigate:!0}})})}}function q(){return function(a,b){return a(d("PolarisStoryActions").refreshStoryReels()).then(function(){var e=c("nullthrows")(d("PolarisuserSelectors").getViewer(b()));a(d("PolarisStoryActions").invalidateStoryReel(e.id));d("browserHistory").browserHistory.push("/");a(d("PolarisNavigationActions").setNavSelection("NAVIGATION_SECTION_HOME"))})}}function r(a,b,c){return{type:"STORY_CREATION_CHANGE_TEXT",rawText:a,width:b,height:c}}function s(){return{type:"STORY_CREATION_ENTER_ADD_TEXT"}}function t(){return{type:"STORY_CREATION_ENTER_EDIT_TEXT"}}function u(a,b){return{type:"STORY_CREATION_SAVE_TEXT",renderText:a,timeSpent:b}}function v(a,b){return{type:"STORY_CREATION_TRANSFORM_CANVAS_STICKER",stillMoving:a,transform:b}}function w(){return{type:"STORY_CREATION_DELETE_CANVAS_STICKER"}}function x(a,b,c){return{type:"STORY_CREATION_MOVE_CANVAS_STICKER",deltaX:a,deltaY:b,overTrash:c}}function y(a){return{type:"STORY_CREATION_CHANGE_ACTIVE_BRUSH",brush:a}}function z(a){return{type:"STORY_CREATION_CHANGE_BRUSH_SIZE",size:a}}function A(a){return{type:"STORY_CREATION_CHANGE_COLOR",color:a}}function B(a){return{type:"STORY_CREATION_CHANGE_DRAW_COLOR",color:a}}function C(){return{type:"STORY_CREATION_EDIT_DRAWING"}}function D(a){return{type:"STORY_CREATION_START_DRAWING",startIndex:a}}function E(a){return{type:"STORY_CREATION_DRAW_LINE",line:a}}function F(a){return{type:"STORY_CREATION_USE_MODAL",isUsingModal:a}}function G(){return{type:"STORY_CREATION_UNDO_DRAWING"}}function H(a){return{type:"STORY_CREATION_SAVE_DRAWING",timeSpent:a}}function I(){return{type:"STORY_CREATION_OPEN_STICKER_TOOL"}}function J(){return{type:"STORY_CREATION_CLOSE_STICKER_TOOL"}}function K(a){return{type:"STORY_CREATION_CHANGE_STICKER_ORDER",bumpIndex:a}}function L(a){return{type:"STORY_CREATION_ADD_STICKER",sticker:a}}function M(){return function(a,b){var c=d("PolarisuserSelectors").getViewer(b());return d("PolarisStoryCreationUtils").getPosition().then(function(b){b={latitude:b.coords.latitude,longitude:b.coords.longitude};return d("PolarisAPI").getStickers({user:c,location:b}).then(function(b){var c=j(b.static_stickers);a({type:"STORY_CREATION_CACHE_STICKER_RESULTS",results:b.static_stickers.slice(c)})},function(b){a({type:"STORY_CREATION_CACHE_STICKER_RESULTS",results:i})})},function(b){return d("PolarisAPI").getStickers({user:c,location:null}).then(function(b){var c=j(b.static_stickers);a({type:"STORY_CREATION_CACHE_STICKER_RESULTS",results:b.static_stickers.slice(c)})},function(b){a({type:"STORY_CREATION_CACHE_STICKER_RESULTS",results:i})})})}}function N(){return function(a,c){return new(b("Promise"))(function(b,c){a({type:"STORY_CREATION_RESET_STICKER_RESULTS"});return b({})})}}function O(){return{type:"STORY_CREATION_SAVE_STORY"}}function P(){return function(a,b){d("PolarisStoryCreationLogger").logStoryCreationEvent(k("exit_attempt",b())),a({type:"STORY_CREATION_EXIT_ATTEMPT"})}}function Q(){return function(a,b){b=b();var c=b.storyCreation.sessionId;d("PolarisStoryCreationLogger").logStoryCreationEvent(k("exit",b));c!=null&&(d("PolarisCreationCameraLogger").logStoryCreationEndCameraSession({sessionId:c}),d("PolarisCreationCameraLogger").logStoryCreationEndPostCapture({sessionId:c}));a({type:"STORY_CREATION_EXIT"})}}function R(){return function(a,b){d("PolarisStoryCreationLogger").logStoryCreationEvent(k("exit_cancel",b())),a({type:"STORY_CREATION_EXIT_CANCEL"})}}function S(){return{type:"STORY_CREATION_TOGGLE_STICKER_VARIANT"}}g.setCanvasDimensions=a;g.startStoryCreationSession=e;g.storyCreationSelectMedia=f;g.storyCreationSelectImage=l;g.storyCreationSelectVideo=m;g.uploadStory=n;g.uploadStoryVideo=p;g.refreshStoryReelAndNavigateToFeed=q;g.changeActiveText=r;g.enterAddText=s;g.enterEditText=t;g.saveText=u;g.transformCanvasSticker=v;g.deleteCanvasSticker=w;g.moveCanvasSticker=x;g.changeBrush=y;g.changeBrushSize=z;g.changeColor=A;g.changeDrawColor=B;g.editDrawing=C;g.startDrawing=D;g.drawLineAction=E;g.useModal=F;g.undoDrawing=G;g.saveDrawing=H;g.openStickerTool=I;g.closeStickerTool=J;g.changeStickerOrder=K;g.addSticker=L;g.cacheStickerResults=M;g.resetStickerResults=N;g.saveStory=O;g.attemptExitStoryCreation=P;g.exitStoryCreation=Q;g.cancelExitStoryCreation=R;g.toggleStickerVariant=S}),98);
__d("PolarisIGCoreErrorPanoOutlineIcon",["PolarisIGCoreSVGIcon","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){return h.jsx(c("PolarisIGCoreSVGIcon"),babelHelpers["extends"]({},a,{viewBox:"0 0 24 24",children:h.jsx("path",{d:"M12.001.504a11.5 11.5 0 1 0 11.5 11.5 11.513 11.513 0 0 0-11.5-11.5Zm0 21a9.5 9.5 0 1 1 9.5-9.5 9.51 9.51 0 0 1-9.5 9.5Zm0-6.594a1.279 1.279 0 1 0 1.278 1.279A1.28 1.28 0 0 0 12 14.91Zm0-8.443a1.326 1.326 0 0 0-.97.412 1.154 1.154 0 0 0-.313.872l.362 5.057a.928.928 0 0 0 1.84 0l.363-5.057a1.152 1.152 0 0 0-.313-.871 1.323 1.323 0 0 0-.97-.413Z"})}))}a.displayName=a.name+" [from "+f.id+"]";b=h.memo(a);g["default"]=b}),98);
__d("PolarisYourActivityGDPRShell",["PolarisGDPRShell.react","PolarisPageIdentifierConstants","PolarisYourActivityShell.react","PolarisYourActivityStrings","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){var b=a.isBlocked;a=babelHelpers.objectWithoutPropertiesLoose(a,["isBlocked"]);var e=c("PolarisPageIdentifierConstants").yourActivityDYIPage;return b?h.jsx(c("PolarisGDPRShell.react"),babelHelpers["extends"]({fullscreenMainContent:!0,isBlocked:b,pageIdentifier:e},a)):h.jsx(c("PolarisYourActivityShell.react"),babelHelpers["extends"]({pageIdentifier:e,title:d("PolarisYourActivityStrings").DYI_TITLE},a))}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);